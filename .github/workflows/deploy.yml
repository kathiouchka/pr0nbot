name: deploy-pr0nbot

on:
  push:
    branches: [ master ]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
    - name: SSH Remote Commands
      uses: appleboy/ssh-action@v0.1.4
      with:
        host: ${{ secrets.HOST }} 
        username: ${{ secrets.USERNAME }}
        password: ${{ secrets.PASSWORD}}
        script: |
          cd pr0nbot/
          git pull
          env GOOS=linux GOARCH=amd64 CGO_ENABLED=0 go build -o pr0nbot
          killall pr0nbot
          nohup bash -c "./pr0nbot -t $pronbotkey 2>&1 &" > pr0nbot.log